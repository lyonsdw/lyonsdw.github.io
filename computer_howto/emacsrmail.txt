	       Reading Mime and Html-encoded Email Using
			   Rmail under Emacs

6/2003

For emacs users who like rmail as an email reader.

%%%%%%%%%%%%%%%%%%%%%%%%%% Note %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  If somebody finds a nicer way to get rmail to handle mime and html
  email, please let me know.

  David Lyons <lyons@lvc.edu>
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Problem: The recent proliferation of email software (such as MS Outlook)
that insist on sending plain text email in mime format, heavily encoded
in html tags, has made reading email with rmail something of a pain.

A Solution: This set-up requires installing two emacs lisp packages, w3m
and emacs-w3m, and pasting some code in your .emacs file.  When you are
looking at an html-encoded message in an rmail buffer, type C-c C-h (or
reset the key binding to whatever you prefer) to view the html message body
in a split window, using the w3m browser that is integrated into emacs.

This set-up includes a key-binding (C-c C-c) that copies mime
attachments to /tmp.

Here's what you have to do.

1.  Download and install two packages (w3m.sourceforge.net).  

w3m
emacs-w3m

If you already have these installed, skip this step.

Note: the package rmime was already installed in my version of emacs.
If you don't have it, get it from the author Ray Moody
<rmoody@cinti.net> at his web page http://www.cinti.net/~rmoody/rmime/ .

2.  Paste and edit some code in your .emacs file. My set-up puts a copy
    of the html-encoded message body in the file ~/tmp/htmltmp.html .
    Edit the lines that refer to this file as appropriate.  

;;;;;;;;; stuff to handle mime encoded messages
(load "rmime")
(setq rmail-decode-mime-charset t)                  
(add-hook 'rmail-show-message-hook 'rmime-format)
(add-hook 'rmail-edit-mode-hook    'rmime-cancel)
(autoload 'rmime-format "rmime" "" nil)
(autoload 'rmime-mode   "rmime" "" t)
;; C-c C-c decodes mime encoded attachment, puts copy in /tmp
(defun attachtotmp ()
   "decode mime attachment, write to /tmp"
   (interactive)
  (rmime-play 0)
  (message "attachment decoded and written to /tmp"))
(define-key rmail-mode-map "\C-c\C-c" 'attachtotmp)  

;;;;; w3m, web browser for emacs, needed to view html encoded messages
;;;;;  this required installing w3m and emacs-w3m
(autoload 'w3m "w3m" "Interface for w3m on Emacs." t)

;;; function to save current (html-encoded) message body in tmp file
;;;  then view with w3m in another window
;;; keybinding C-c C-h gives a shortcut
(defun htmlmsgsee ()
   "view html-encoded email message using w3m"
   (interactive)
   (rmail-output-body-to-file "~/tmp/htmltmp.html")
   (rmail-undelete-previous-message)
   (message "message body written to ~/tmp/htmltmp.html")
   (find-file-other-window "~/tmp/")
   (w3m)
   (w3m-find-file "~/tmp/htmltmp.html")
   (w3m-redisplay-this-page)
)
(define-key rmail-mode-map "\C-c\C-h" 'htmlmsgsee)
